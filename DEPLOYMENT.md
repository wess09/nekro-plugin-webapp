# WebApp å¿«é€Ÿéƒ¨ç½²æ’ä»¶ - éƒ¨ç½²æŒ‡å—

> å®Œæ•´çš„ Cloudflare Workers éƒ¨ç½²æ­¥éª¤å’Œé…ç½®è¯´æ˜

## ğŸ“‹ ç›®å½•

- [å‰ç½®è¦æ±‚](#å‰ç½®è¦æ±‚)
- [éƒ¨ç½²æ­¥éª¤](#éƒ¨ç½²æ­¥éª¤)
- [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)
- [å¯†é’¥ç®¡ç†](#å¯†é’¥ç®¡ç†)
- [é«˜çº§é…ç½®](#é«˜çº§é…ç½®)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)

---

## ğŸ”§ å‰ç½®è¦æ±‚

### å¿…éœ€è´¦å·

- âœ… [Cloudflare è´¦å·](https://dash.cloudflare.com/sign-up) - å…è´¹ï¼Œæ— éœ€ä¿¡ç”¨å¡
- âœ… [GitHub è´¦å·](https://github.com) - ç”¨äºä»£ç æ‰˜ç®¡å’Œè‡ªåŠ¨éƒ¨ç½²

### æ¨èå·¥å…·ï¼ˆå¯é€‰ï¼‰

- `wrangler` CLI - Cloudflare Workers å‘½ä»¤è¡Œå·¥å…·
- `pnpm` - å¿«é€Ÿçš„åŒ…ç®¡ç†å™¨
- Node.js >= 18.0.0 - ç”¨äºæœ¬åœ°å¼€å‘æµ‹è¯•

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šFork ä»“åº“

1. è®¿é—®é¡¹ç›® GitHub é¡µé¢ï¼š[nekro-plugin-webapp](https://github.com/KroMiose/nekro-plugin-webapp)
2. ç‚¹å‡»é¡µé¢å³ä¸Šè§’çš„ **Fork** æŒ‰é’®
3. é€‰æ‹©ä½ çš„è´¦å·ï¼Œç‚¹å‡» **Create fork**
4. ç­‰å¾… fork å®Œæˆï¼ˆé€šå¸¸å‡ ç§’é’Ÿï¼‰

âœ… **æ£€æŸ¥ç‚¹**ï¼šä½ çš„ GitHub è´¦å·ä¸‹ç°åœ¨æœ‰ä¸€ä¸ª `nekro-plugin-webapp` ä»“åº“

---

### ç¬¬äºŒæ­¥ï¼šåˆ›å»º D1 æ•°æ®åº“

1. ç™»å½• [Cloudflare Dashboard](https://dash.cloudflare.com)
2. åœ¨å·¦ä¾§èœå•é€‰æ‹© **Workers & Pages** â†’ **D1**
3. ç‚¹å‡» **Create database** æŒ‰é’®
4. å¡«å†™æ•°æ®åº“åç§°ï¼š`nekro-webapp-db`ï¼ˆæˆ–å…¶ä»–ä½ å–œæ¬¢çš„åç§°ï¼‰
5. ç‚¹å‡» **Create** åˆ›å»ºæ•°æ®åº“
6. åˆ›å»ºæˆåŠŸåï¼Œåœ¨æ•°æ®åº“è¯¦æƒ…é¡µé¢æ‰¾åˆ° **Database ID**
7. **å¤åˆ¶è¿™ä¸ª Database ID**ï¼ˆæ ¼å¼å¦‚ï¼š`xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx`ï¼‰

âœ… **æ£€æŸ¥ç‚¹**ï¼šå·²è·å¾— Database ID

---

### ç¬¬ä¸‰æ­¥ï¼šé…ç½® Database ID

1. åœ¨ä½  fork çš„ GitHub ä»“åº“ä¸­ï¼Œæ‰“å¼€ `worker/wrangler.toml` æ–‡ä»¶
2. æ‰¾åˆ° `[[d1_databases]]` éƒ¨åˆ†ï¼š
   ```toml
   [[d1_databases]]
   binding = "DB"
   database_name = "webapp-db"
   database_id = "2fc7f7a6-3370-4430-9093-e907cb68f761"  # è¯·æ›¿æ¢ä¸ºä½ çš„ Database ID
   ```
3. ç‚¹å‡»æ–‡ä»¶ç¼–è¾‘æŒ‰é’®ï¼ˆé“…ç¬”å›¾æ ‡ï¼‰
4. **å°†ç¤ºä¾‹ Database ID æ›¿æ¢ä¸ºä½ åˆšæ‰å¤åˆ¶çš„å®é™… Database ID**
5. æäº¤æ›´æ”¹ï¼š
   - Commit message: `chore: update database id`
   - ç‚¹å‡» **Commit changes**

âœ… **æ£€æŸ¥ç‚¹**ï¼š`wrangler.toml` ä¸­å·²å¡«å†™ä½ çš„ Database ID

---

### ç¬¬å››æ­¥ï¼šè¿æ¥ GitHub éƒ¨ç½² Worker

1. åœ¨ Cloudflare Dashboard å·¦ä¾§èœå•é€‰æ‹© **Workers & Pages**
2. ç‚¹å‡» **Create application** æŒ‰é’®
3. é€‰æ‹© **Pages** æ ‡ç­¾
4. ç‚¹å‡» **Connect to Git** æŒ‰é’®
5. å¦‚æœæ˜¯é¦–æ¬¡ä½¿ç”¨ï¼Œéœ€è¦æˆæƒ Cloudflare è®¿é—®ä½ çš„ GitHub
6. åœ¨ä»“åº“åˆ—è¡¨ä¸­é€‰æ‹©ä½  fork çš„ `nekro-plugin-webapp` ä»“åº“
7. ç‚¹å‡» **Begin setup** å¼€å§‹é…ç½®

**é‡è¦é…ç½®é¡¹ï¼š**

| é…ç½®é¡¹ | å€¼ | è¯´æ˜ |
|--------|-----|------|
| **Project name** | `nekro-webapp`ï¼ˆæˆ–è‡ªå®šä¹‰ï¼‰ | é¡¹ç›®åç§°ï¼Œä¼šæˆä¸ºåŸŸåçš„ä¸€éƒ¨åˆ† |
| **Production branch** | `main` | ç”Ÿäº§ç¯å¢ƒåˆ†æ”¯ |
| **Framework preset** | `None` | ä¸ä½¿ç”¨æ¡†æ¶é¢„è®¾ |
| **Build command** | `pnpm run build` | âš ï¸ å¿…å¡«ï¼ |
| **Build output directory** | ç•™ç©º | ä¸éœ€è¦å¡«å†™ |
| **Root directory** | `/worker` | âš ï¸ å¿…å¡«ï¼æŒ‡å‘ worker å­ç›®å½• |

8. é…ç½®å®Œæˆåï¼Œç‚¹å‡» **Save and Deploy** æŒ‰é’®

â±ï¸ **ç­‰å¾…æ„å»º**ï¼šCloudflare ä¼šè‡ªåŠ¨æ„å»ºå’Œéƒ¨ç½²ï¼Œé€šå¸¸éœ€è¦ 2-3 åˆ†é’Ÿã€‚

âœ… **å®Œæˆ**ï¼šéƒ¨ç½²æˆåŠŸåï¼Œä½ å°†è·å¾— Worker URLï¼ˆæ ¼å¼å¦‚ï¼š`https://nekro-webapp.pages.dev`ï¼‰

---

### ç¬¬äº”æ­¥ï¼šéªŒè¯éƒ¨ç½²

1. å¤åˆ¶ä½ çš„ Worker URL
2. åœ¨æµè§ˆå™¨ä¸­è®¿é—®è¿™ä¸ª URL
3. é¦–æ¬¡è®¿é—®æ—¶ï¼Œæ•°æ®åº“ä¼š**è‡ªåŠ¨åˆå§‹åŒ–**ï¼ˆåŒ…æ‹¬åˆ›å»º settings è¡¨ç­‰ï¼‰
4. ä½ åº”è¯¥çœ‹åˆ°ä¸€ä¸ªæ¬¢è¿é¡µé¢ï¼Œæ˜¾ç¤º "WebApp å¿«é€Ÿéƒ¨ç½²æœåŠ¡"

**æ£€æŸ¥å¥åº·çŠ¶æ€ï¼š**
```bash
curl https://your-worker.pages.dev/api/health
# åº”è¯¥è¿”å›: {"status":"healthy","timestamp":...,"initialized":false}
```

âœ… **å®Œæˆ**ï¼Worker ç°åœ¨å¯ä»¥ä½¿ç”¨äº†

---

### ç¬¬ä¸ƒæ­¥ï¼šè®¾ç½®ç®¡ç†å¯†é’¥

1. æ‰“å¼€ NekroAgent
2. è¿›å…¥æ’ä»¶ç®¡ç†é¡µé¢
3. æ‰¾åˆ° **WebApp å¿«é€Ÿéƒ¨ç½²** æ’ä»¶
4. å¡«å†™é…ç½®ï¼š
   - **WORKER_URL**: ä½ çš„ Worker URLï¼ˆå¦‚ï¼š`https://nekro-webapp.pages.dev`ï¼‰
   - **ACCESS_KEY**: æš‚æ—¶ç•™ç©ºï¼ˆç¨åå¡«å†™ï¼‰
5. ä¿å­˜é…ç½®

6. è®¿é—®ç®¡ç†ç•Œé¢ï¼š`http://localhost:8021/plugins/KroMiose.nekro_plugin_webapp/`

7. é¦–æ¬¡è®¿é—®ä¼šæç¤ºè®¾ç½®ç®¡ç†å¯†é’¥ï¼š
   - è¾“å…¥ä¸€ä¸ªå¼ºå¯†é’¥ï¼ˆè‡³å°‘ 8 ä¸ªå­—ç¬¦ï¼‰
   - å»ºè®®ä½¿ç”¨éšæœºå­—ç¬¦ä¸²ï¼Œå¦‚ï¼š`Admin@2024!Secure`
   - ç‚¹å‡»"è®¾ç½®ç®¡ç†å¯†é’¥"æŒ‰é’®

8. è®¾ç½®æˆåŠŸåï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨ç®¡ç†å¯†é’¥ç™»å½•è¿›å…¥ç®¡ç†ç•Œé¢

âœ… **å®Œæˆ**ï¼ç®¡ç†å¯†é’¥å·²è®¾ç½®

---

### ç¬¬å…«æ­¥ï¼šåˆ›å»ºè®¿é—®å¯†é’¥

**ä¸ºä»€ä¹ˆéœ€è¦è®¿é—®å¯†é’¥ï¼Ÿ**
- ç®¡ç†å¯†é’¥æƒé™è¿‡å¤§ï¼Œä¸åº”ç”¨äºæ—¥å¸¸æ“ä½œ
- è®¿é—®å¯†é’¥ä¸“é—¨ç”¨äºåˆ›å»ºé¡µé¢ï¼Œæƒé™å—é™ï¼Œæ›´å®‰å…¨
- ç¬¦åˆæœ€å°æƒé™åŸåˆ™

**åˆ›å»ºæ­¥éª¤ï¼š**

1. åœ¨ç®¡ç†ç•Œé¢ä¸­ï¼Œç‚¹å‡»"å¯†é’¥ç®¡ç†"æ ‡ç­¾
2. ç‚¹å‡»"åˆ›å»ºè®¿é—®å¯†é’¥"æŒ‰é’®
3. è¾“å…¥å¯†é’¥åç§°ï¼Œå¦‚ï¼š`nekro-agent-access`
4. ç‚¹å‡»"åˆ›å»º"æŒ‰é’®
5. **é‡è¦**ï¼šå¤åˆ¶ç”Ÿæˆçš„è®¿é—®å¯†é’¥ï¼ˆåªæ˜¾ç¤ºè¿™ä¸€æ¬¡ï¼ï¼‰

6. å›åˆ° NekroAgent æ’ä»¶é…ç½®é¡µé¢
7. å¡«å†™ **ACCESS_KEY**ï¼šç²˜è´´åˆšæ‰å¤åˆ¶çš„è®¿é—®å¯†é’¥
8. ä¿å­˜é…ç½®

âœ… **é…ç½®å®Œæˆ**ï¼ç°åœ¨ AI å¯ä»¥è‡ªåŠ¨éƒ¨ç½²ç½‘é¡µäº†

---

### ç¬¬ä¹æ­¥ï¼šæµ‹è¯•éƒ¨ç½²

è®© AI å¸®ä½ åˆ›å»ºç¬¬ä¸€ä¸ªç½‘é¡µï¼š

```
ä½ ï¼šå¸®æˆ‘åˆ›å»ºä¸€ä¸ªç®€å•çš„ Hello World ç½‘é¡µ

AIï¼šå¥½çš„ï¼Œæˆ‘æ¥åˆ›å»ºä¸€ä¸ª Hello World é¡µé¢ã€‚
[AI è°ƒç”¨ create_web_app]

è¿”å›ï¼š
âœ… ç½‘é¡µéƒ¨ç½²æˆåŠŸï¼
ğŸ“„ æ ‡é¢˜: Hello World
ğŸ”— è®¿é—®é“¾æ¥: https://your-worker.pages.dev/abc12345
ğŸ†” é¡µé¢ID: abc12345
â° åˆ›å»ºæ—¶é—´: 2025-10-22 15:30:00
ğŸ“… è¿‡æœŸæ—¶é—´: 2025-11-21 15:30:00
```

ç‚¹å‡»é“¾æ¥ï¼Œåº”è¯¥èƒ½çœ‹åˆ°ä½ çš„ç½‘é¡µï¼

âœ… **å¤§åŠŸå‘Šæˆ**ï¼ğŸ‰

---

## âš™ï¸ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

åœ¨ `wrangler.toml` ä¸­é…ç½®çš„ç¯å¢ƒå˜é‡ï¼š

```toml
[vars]
DB_INITIALIZED = "false"  # æ•°æ®åº“åˆå§‹åŒ–æ ‡å¿—
```

### æ•°æ®åº“ç»‘å®š

```toml
[[d1_databases]]
binding = "DB"                    # ç»‘å®šåç§°ï¼ˆä»£ç ä¸­ä½¿ç”¨ï¼‰
database_name = "webapp-db"       # æ•°æ®åº“é€»è¾‘åç§°
database_id = "your-database-id"  # å®é™…çš„æ•°æ®åº“ ID
```

### æ„å»ºé…ç½®

Worker ä½¿ç”¨ TypeScript ç¼–å†™ï¼Œé€šè¿‡ `esbuild` æ„å»ºï¼š

```json
{
  "scripts": {
    "build": "esbuild src/index.ts --bundle --format=esm --outfile=_worker.js --platform=browser --target=esnext"
  }
}
```

---

## ğŸ” å¯†é’¥ç®¡ç†

### å¯†é’¥ç±»å‹å¯¹æ¯”

| ç‰¹æ€§ | ç®¡ç†å¯†é’¥ | è®¿é—®å¯†é’¥ |
|------|---------|---------|
| **ç”¨é€”** | ç®¡ç†ç³»ç»Ÿ | åˆ›å»ºé¡µé¢ |
| **æƒé™** | manageï¼ˆå®Œå…¨æƒé™ï¼‰ | create, view |
| **èƒ½åˆ›å»ºé¡µé¢** | âŒ ä¸èƒ½ | âœ… èƒ½ |
| **èƒ½ç®¡ç†å¯†é’¥** | âœ… èƒ½ | âŒ ä¸èƒ½ |
| **èƒ½åˆ é™¤é¡µé¢** | âœ… èƒ½ | âŒ ä¸èƒ½ |
| **å­˜å‚¨ä½ç½®** | settings è¡¨ | api_keys è¡¨ |
| **è®¾ç½®æ–¹å¼** | é¦–æ¬¡è®¿é—®ç®¡ç†ç•Œé¢ | ç®¡ç†ç•Œé¢åˆ›å»º |

### å¯†é’¥æƒé™è¯¦è§£

**ç®¡ç†å¯†é’¥ï¼ˆAdmin Keyï¼‰**ï¼š
- æƒé™ï¼š`manage`ï¼ˆåŒ…å«æ‰€æœ‰æƒé™ï¼‰
- å¯ä»¥åšï¼š
  - âœ… åˆ›å»º/åˆ é™¤è®¿é—®å¯†é’¥
  - âœ… æŸ¥çœ‹æ‰€æœ‰é¡µé¢åˆ—è¡¨
  - âœ… åˆ é™¤ä»»ä½•é¡µé¢
  - âœ… æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯
  - âœ… ä¿®æ”¹ç®¡ç†å¯†é’¥
- ä¸èƒ½åšï¼š
  - âŒ åˆ›å»ºé¡µé¢ï¼ˆæƒé™åˆ†ç¦»è®¾è®¡ï¼‰

**è®¿é—®å¯†é’¥ï¼ˆAccess Keyï¼‰**ï¼š
- æƒé™ï¼š`create, view`
- å¯ä»¥åšï¼š
  - âœ… åˆ›å»ºé¡µé¢
  - âœ… æŸ¥çœ‹å•ä¸ªé¡µé¢ä¿¡æ¯
- ä¸èƒ½åšï¼š
  - âŒ æŸ¥çœ‹æ‰€æœ‰é¡µé¢åˆ—è¡¨
  - âŒ åˆ é™¤é¡µé¢
  - âŒ ç®¡ç†å¯†é’¥

### ä¿®æ”¹ç®¡ç†å¯†é’¥

1. ä½¿ç”¨æ—§ç®¡ç†å¯†é’¥ç™»å½•ç®¡ç†ç•Œé¢
2. è¿›å…¥"ç³»ç»Ÿç®¡ç†"æ ‡ç­¾
3. ç‚¹å‡»"ä¿®æ”¹ç®¡ç†å¯†é’¥"
4. è¾“å…¥æ—§å¯†é’¥å’Œæ–°å¯†é’¥
5. ç¡®è®¤ä¿®æ”¹

**æ³¨æ„**ï¼šä¿®æ”¹åéœ€è¦ç”¨æ–°å¯†é’¥é‡æ–°ç™»å½•ã€‚

---

## ğŸ”§ é«˜çº§é…ç½®

### è‡ªå®šä¹‰åŸŸå

1. åœ¨ Cloudflare Dashboard ä¸­è¿›å…¥ä½ çš„ Pages é¡¹ç›®
2. é€‰æ‹© **Custom domains** æ ‡ç­¾
3. ç‚¹å‡» **Add a custom domain**
4. è¾“å…¥ä½ çš„åŸŸåï¼ˆåŸŸåéœ€è¦åœ¨ Cloudflare æ‰˜ç®¡ï¼‰
5. å®Œæˆ DNS é…ç½®
6. æ›´æ–°æ’ä»¶é…ç½®ä¸­çš„ `WORKER_URL` ä¸ºä½ çš„è‡ªå®šä¹‰åŸŸå

### å®šæœŸæ¸…ç†è¿‡æœŸé¡µé¢

Worker ä¼šåœ¨æ¯æ¬¡è®¿é—®æ—¶è‡ªåŠ¨æ£€æŸ¥å¹¶æ ‡è®°è¿‡æœŸé¡µé¢ä¸ºä¸æ´»è·ƒçŠ¶æ€ã€‚

å¦‚æœéœ€è¦å½»åº•åˆ é™¤è¿‡æœŸæ•°æ®ï¼Œå¯ä»¥åœ¨ D1 Console ä¸­è¿è¡Œï¼š

```sql
-- åˆ é™¤è¿‡æœŸä¸”å·²åœç”¨çš„é¡µé¢
DELETE FROM pages
WHERE is_active = 0
  AND expires_at < CAST((julianday('now') - 2440587.5) * 86400000 AS INTEGER);
```

### å¯ç”¨è®¿é—®æ—¥å¿—

è®¿é—®æ—¥å¿—è¡¨ `access_logs` é»˜è®¤å·²åˆ›å»ºï¼Œä½†æœªå¯ç”¨ã€‚

å¦‚éœ€å¯ç”¨ï¼Œä¿®æ”¹ `worker/src/storage.ts` ä¸­çš„ `incrementAccessCount` å‡½æ•°ï¼š

```typescript
export async function incrementAccessCount(pageId: string, env: Env): Promise<void> {
  const now = Date.now();
  
  // æ›´æ–°è®¿é—®è®¡æ•°
  await env.DB.prepare(`
    UPDATE pages 
    SET access_count = access_count + 1, last_accessed = ?
    WHERE page_id = ?
  `)
    .bind(now, pageId)
    .run();
  
  // è®°å½•è®¿é—®æ—¥å¿—ï¼ˆæ–°å¢ï¼‰
  await env.DB.prepare(`
    INSERT INTO access_logs (page_id, accessed_at)
    VALUES (?, ?)
  `)
    .bind(pageId, now)
    .run();
}
```

---

## ğŸ› ï¸ æ•…éšœæ’é™¤

### Worker éƒ¨ç½²å¤±è´¥

**ç—‡çŠ¶**ï¼šæ„å»ºè¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯

**å¯èƒ½åŸå› **ï¼š
1. æœªè®¾ç½®æ­£ç¡®çš„ Build command
2. Root directory æœªè®¾ç½®ä¸º `/worker`
3. Database ID æœªæ›¿æ¢

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ Pages é¡¹ç›®çš„æ„å»ºè®¾ç½®
2. ç¡®è®¤ Build command ä¸º `pnpm run build`
3. ç¡®è®¤ Root directory ä¸º `/worker`
4. é‡æ–°éƒ¨ç½²ï¼šSettings â†’ Builds & deployments â†’ Retry deployment

### æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥

**ç—‡çŠ¶**ï¼šè®¿é—® Worker æ—¶æç¤º "no such table: settings"

**åŸå› **ï¼šæ•°æ®åº“è¡¨ç»“æ„æœªæ­£ç¡®åˆå§‹åŒ–

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. è¿›å…¥ Cloudflare Dashboard â†’ D1 â†’ ä½ çš„æ•°æ®åº“
2. ç‚¹å‡» Console æ ‡ç­¾
3. å¤åˆ¶ `worker/schema.sql` çš„å®Œæ•´å†…å®¹
4. ç²˜è´´å¹¶æ‰§è¡Œ
5. æˆ–ä½¿ç”¨ wrangler CLIï¼š
   ```bash
   wrangler d1 execute webapp-db --file=worker/schema.sql
   ```

### ç®¡ç†ç•Œé¢æ— æ³•è®¿é—®

**ç—‡çŠ¶**ï¼šè®¿é—®ç®¡ç†ç•Œé¢æ—¶æç¤º 404 æˆ–æ— æ³•åŠ è½½

**å¯èƒ½åŸå› **ï¼š
1. WORKER_URL é…ç½®é”™è¯¯
2. Worker æœªéƒ¨ç½²æˆåŠŸ
3. ç½‘ç»œè¿æ¥é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ `WORKER_URL` é…ç½®æ˜¯å¦æ­£ç¡®ï¼ˆä¸è¦åŒ…å«å°¾éƒ¨æ–œæ ï¼‰
2. ç›´æ¥åœ¨æµè§ˆå™¨è®¿é—® Worker URL éªŒè¯æ˜¯å¦å¯ç”¨
3. æ£€æŸ¥ `/api/health` ç«¯ç‚¹æ˜¯å¦å“åº”æ­£å¸¸
4. æŸ¥çœ‹ Worker æ—¥å¿—ï¼šDashboard â†’ Pages â†’ your-project â†’ Logs

### è®¿é—®å¯†é’¥åˆ›å»ºå¤±è´¥

**ç—‡çŠ¶**ï¼šç‚¹å‡»"åˆ›å»ºè®¿é—®å¯†é’¥"åæ— å“åº”æˆ–æŠ¥é”™

**å¯èƒ½åŸå› **ï¼š
1. ç®¡ç†å¯†é’¥éªŒè¯å¤±è´¥
2. æ•°æ®åº“è¿æ¥é—®é¢˜
3. api_keys è¡¨ä¸å­˜åœ¨

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. é€€å‡ºç™»å½•åé‡æ–°ä½¿ç”¨ç®¡ç†å¯†é’¥ç™»å½•
2. æ£€æŸ¥æ•°æ®åº“ä¸­ api_keys è¡¨æ˜¯å¦å­˜åœ¨ï¼š
   ```sql
   SELECT name FROM sqlite_master WHERE type='table' AND name='api_keys';
   ```
3. å¦‚æœè¡¨ä¸å­˜åœ¨ï¼Œé‡æ–°æ‰§è¡Œ schema.sql

### AI åˆ›å»ºé¡µé¢å¤±è´¥ï¼ˆ401é”™è¯¯ï¼‰

**ç—‡çŠ¶**ï¼šAI è°ƒç”¨æ’ä»¶æ—¶è¿”å› 401 Unauthorized

**å¯èƒ½åŸå› **ï¼š
1. ACCESS_KEY æœªé…ç½®æˆ–é…ç½®é”™è¯¯
2. è®¿é—®å¯†é’¥å·²è¢«åˆ é™¤
3. è®¿é—®å¯†é’¥è¿‡æœŸ

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥æ’ä»¶é…ç½®ä¸­çš„ `ACCESS_KEY` æ˜¯å¦æ­£ç¡®
2. åœ¨ç®¡ç†ç•Œé¢æŸ¥çœ‹è®¿é—®å¯†é’¥åˆ—è¡¨ï¼Œç¡®è®¤å¯†é’¥å­˜åœ¨ä¸”æ´»è·ƒ
3. é‡æ–°åˆ›å»ºè®¿é—®å¯†é’¥å¹¶æ›´æ–°é…ç½®
4. é‡å¯ NekroAgent ä½¿é…ç½®ç”Ÿæ•ˆ

### æ—¶é—´æ˜¾ç¤ºé”™è¯¯ï¼ˆå¹´ä»½å¼‚å¸¸ï¼‰

**ç—‡çŠ¶**ï¼šé¡µé¢åˆ›å»ºæ—¶é—´æ˜¾ç¤ºä¸ºé¥è¿œçš„æœªæ¥ï¼ˆå¦‚ 57778 å¹´ï¼‰

**åŸå› **ï¼šæ—¶é—´æˆ³å•ä½è½¬æ¢é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
- å·²åœ¨æœ€æ–°ç‰ˆæœ¬ä¿®å¤
- å¦‚æœä»æœ‰é—®é¢˜ï¼Œç¡®ä¿ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„æ’ä»¶ä»£ç 
- JavaScript è¿”å›æ¯«ç§’çº§æ—¶é—´æˆ³ï¼ŒPython éœ€è¦é™¤ä»¥ 1000

---

## ğŸ“Š èµ„æºé™åˆ¶

### Cloudflare å…è´¹è®¡åˆ’

| èµ„æº | é™åˆ¶ |
|------|------|
| D1 å­˜å‚¨ | 10 GB |
| æ¯å¤©è¯»å– | 500 ä¸‡æ¬¡ |
| æ¯å¤©å†™å…¥ | 10 ä¸‡æ¬¡ |
| Worker è¯·æ±‚ | æ¯å¤© 10 ä¸‡æ¬¡ |
| Worker æ‰§è¡Œæ—¶é—´ | æ¯æ¬¡ 50ms (å…è´¹) |

### æ¨èé…ç½®

**åœ¨ Worker ç®¡ç†ç•Œé¢"ç³»ç»Ÿé…ç½®"ä¸­è®¾ç½®**ï¼š

| åœºæ™¯ | é¡µé¢è¿‡æœŸå¤©æ•° | HTML æœ€å¤§å¤§å° |
|------|-------------|--------------|
| ä¸´æ—¶å±•ç¤º | 7 å¤© | 300 KB |
| ä¸€èˆ¬ä½¿ç”¨ | 30 å¤© | 500 KB |
| é•¿æœŸä¿å­˜ | 0ï¼ˆæ°¸ä¹…ï¼‰ | 500 KB |
| å¤§å‹é¡µé¢ | 30 å¤© | 1000 KB |

---

## ğŸ”„ æ›´æ–°éƒ¨ç½²

### è‡ªåŠ¨æ›´æ–°ï¼ˆæ¨èï¼‰

1. åœ¨ GitHub ä»“åº“ä¸­åŒæ­¥ä¸Šæ¸¸æ›´æ–°ï¼š
   ```bash
   git remote add upstream https://github.com/KroMiose/nekro-plugin-webapp.git
   git fetch upstream
   git merge upstream/main
   git push origin main
   ```

2. Cloudflare Pages ä¼šè‡ªåŠ¨æ£€æµ‹åˆ°æ›´æ”¹å¹¶é‡æ–°éƒ¨ç½²

### æ‰‹åŠ¨æ›´æ–°

1. ç™»å½• Cloudflare Dashboard
2. è¿›å…¥ä½ çš„ Pages é¡¹ç›®
3. é€‰æ‹© **Deployments** æ ‡ç­¾
4. ç‚¹å‡» **Retry deployment** é‡æ–°éƒ¨ç½²æœ€æ–°ä»£ç 

---

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. ğŸ“– æŸ¥é˜…æœ¬æ–‡æ¡£çš„æ•…éšœæ’é™¤éƒ¨åˆ†
2. ğŸ” åœ¨ [Issues](https://github.com/KroMiose/nekro-plugin-webapp/issues) ä¸­æœç´¢ç±»ä¼¼é—®é¢˜
3. ğŸ› [åˆ›å»ºæ–° Issue](https://github.com/KroMiose/nekro-plugin-webapp/issues/new) æè¿°ä½ çš„é—®é¢˜
4. ğŸ’¬ åŠ å…¥ç¤¾åŒºè®¨è®º

---

## ğŸ“š ç›¸å…³é“¾æ¥

- [README.md](./README.md) - ç”¨æˆ·ä½¿ç”¨æŒ‡å—
- [DEVELOPMENT.md](./DEVELOPMENT.md) - å¼€å‘è€…æ–‡æ¡£
- [Cloudflare Workers æ–‡æ¡£](https://developers.cloudflare.com/workers/)
- [D1 æ•°æ®åº“æ–‡æ¡£](https://developers.cloudflare.com/d1/)
- [Cloudflare Pages æ–‡æ¡£](https://developers.cloudflare.com/pages/)

---

**æœ€åæ›´æ–°**: 2025-10-22  
**ç»´æŠ¤è€…**: NekroAgent Team

